<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" integrity="sha512-8bHTC73gkZ7rZ7vpqUQThUDhqcNFyYi2xgDgPDHc+GXVGHXq+xPjynxIopALmOPqzo9JZj0k6OqqewdGO3EsrQ==" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css"
    integrity="sha512-BnbUDfEUfV0Slx6TunuB042k9tuKe3xrD6q4mg5Ed72LTgzDIcLPxg6yI2gcMFRyomt+yJJxE+zJwNmxki6/RA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />
    <title>Crunch&&Munch</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
   
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWC5gcMOWS2Ih_G8npccQ5xvfllB0xmQk&libraries=places"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>

<script>

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (p) {
        var LatLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
        var mapOptions = {
            center: LatLng,
            zoom: 13,
            mapTypeControl: false,
            streetViewControl: false,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        
        var infoWindow = new google.maps.InfoWindow();
        var latlngbounds = new google.maps.LatLngBounds();
        var geocoder = geocoder = new google.maps.Geocoder();
        var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
        var marker = new google.maps.Marker({
            position: LatLng,
            draggable: true,
            //title: "Hello world!",
            map: map,
            animation: google.maps.Animation
            //title: "<div style = 'height:60px;width:200px'><b>Your location:</b><br />Latitude: " + p.coords.latitude + "<br />Longitude: " + p.coords.longitude
        });


        google.maps.event.addListener(marker, "click", function (e) {
            var infoWindow = new google.maps.InfoWindow();
            infoWindow.setContent(marker.getPosition());
            infoWindow.open(map, marker);

        });

        var mapOptions, map, marker, searchBox,
            infoWindow = '',
            addressEl = document.querySelector('#map-search'),
            latEl = document.querySelector('.latitude'),
            longEl = document.querySelector('.longitude'),
            element = document.getElementById('dvMap');
        
        searchBox = new google.maps.places.SearchBox(addressEl);

        google.maps.event.addListener(searchBox, 'places_changed', function () {
            var places = searchBox.getPlaces(),
                bounds = new google.maps.LatLngBounds(),
                i, place, lat, long, resultArray,
                addresss = places[0].formatted_address;

            for (i = 0; place = places[i]; i++) {
                bounds.extend(place.geometry.location);
                marker.setPosition(place.geometry.location);  
            }

            map.fitBounds(bounds);  
            map.setZoom(15); 

            lat = marker.getPosition().lat();
            long = marker.getPosition().lng();
            latEl.value = lat;
            longEl.value = long;

            resultArray = places[0].address_components;

         
            if (infoWindow) {
                infoWindow.close();
            }
            
            infoWindow = new google.maps.InfoWindow({
                content: addresss
            });

            infoWindow.open(map, marker);
        });




        /**
     * Finds the new position of the marker when the marker is dragged.
     */
        google.maps.event.addListener(marker, "dragend", function (event) {
            var lat, long, address, resultArray, citi;

            console.log('i am dragged');
            lat = marker.getPosition().lat();
            long = marker.getPosition().lng();

            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ latLng: marker.getPosition() }, function (result, status) {
                if ('OK' === status) { 
                    address = result[0].formatted_address;
                    resultArray = result[0].address_components;

                    addressEl.value = address;
                    latEl.value = lat;
                    longEl.value = long;

                } else {
                    console.log('Geocode was not successful for the following reason: ' + status);
                }

                
                if (infoWindow) {
                    infoWindow.close();
                }

               
                // infoWindow = new google.maps.InfoWindow({
                //    content: address
                // }); 

                infoWindow.open(map, marker);
            });
        });


        (marker, data);
        latlngbounds.extend(marker.position);

        var bounds = new google.maps.LatLngBounds();
        map.setCenter(latlngbounds.getCenter());
        map.fitBounds(latlngbounds);

    });
}
else {
    alert('Geo Location feature is not supported in this browser.');
}




var showlocation;
var callback;

function showlocation() {
    
    navigator.geolocation.watchPosition(callback);
    
}
function callback(position) {
    debugger
    

    document.getElementById('lati').innerHTML = position.coords.latitude;
    document.getElementById('longi').innerHTML = position.coords.longitude;
    var geocoder = new google.maps.Geocoder();
    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    var latLng = new google.maps.LatLng(latitude, longitude);
    geocoder.geocode({
        latLng: latLng,
  
    },
        function (responses) {
            if (responses && responses.length > 0) {
                console.log(responses[0].formatted_address)
                document.querySelector("#map-search").value = responses[0].formatted_address
                document.querySelector("#lati").value = latitude
                document.querySelector("#longi").value = longitude
               
            }
            else {
                alert('Not getting Any address for given latitude and longitude.');
            }
        }
    );


}
function address(str) {
    document.getElementById('map-search').innerHTML = str;
}




</script>

  </body>
</html>
